# System Log
> 시스템 로그
- 로그는 커널과 리눅스 시스템이 제공하는   여러 서비스와 응용 프로그램이 발생시키는 메시지를 뜻함 <br>
  
 - 로그를 저장하고 있는 파일을 로그 파일<br>
 - 로그 파일을 통해 시스템의 상태를 확인<br>
 - 보안 사고에 대비하며 사고가 발생했을 때는 원인을 규명하고  침입 경로를 추적하기 위해 가장 기본적으로 로그 파일을 확인

> 주요 로그 파일
- 리눅스 시스템에는 기본 로그 파일을 비롯해 다양한 로그 파일이 있음<br>
- 대부분의 로그 파일은 '/var/log' 디렉터리에 있음
---
## 로그파일 관리하기

    '/var/log' 디렉터리의 내용을 보면 같은 파일명에 번호가 붙은 파일이 여러개 있다. 
    이는 로그를 계속 한 파일에 저장할 경우 파일의 크기가 너무 커져서 내용을 보거나 관리할 때 불편하기 때문이다. 
    따라서 번호가 큰 로그 파일은 백업을 하고 삭제해야한다.
    시스템이 여러 가지 서비스를 제공하기 시작하면 로그 파일에 기록되는 내용도 급격히 증가한다.
    그래서 어느정도 되면 파일들이 디스크에서 차지하는 용량을 무시할 수 없게된다.
    로그 파일의 소유자는 거의 대부분 'root' 계정이다.
    접근 권한은 대부분의 경우 'root' 계정만 읽고 쓸 수 있게 설정되어있다.
    'dmesg' 로그 파일은 'root' 계정만 읽고 쓰기가 가능, 'adm' 그룹은 읽기만 가능하다.
    주요 로그 파일들은 로그 관리 데몬으로 로그 파일을 관리한다.

* dmesg(diagnostic message)는 kernel의 ring buffer를 출력하는 명령어로 부팅시에 인식한 장치 등 시스템 진단에 필요한 유용한 정보를 제공한다. <br>
  사용법 : https://www.lesstif.com/lpt/log-dmesg-98926711.html

* 공통적인 로그파일로 /var/log/syslog가 있고 다른 자세한 로그파일들은 출처를 참고하면 된다. 

---

## 로그 관리 데몬 

    리눅스 시스템의 로그 파일 중 일부는 로그 관리 데몬에 의해 통제된다.
    rsyslog 서비스를 제공하는 데몬은 'rsyslogd'이고, rsyslog 서비스를 설정하는 파일은 '/etc/rsyslog.d' 디렉터리에 있는 *.conf 파일이다.
    '50-default.conf' 는 어떤 로그를 어떻게 처리할 것인지 기본 규칙을 설정한 파일이다.
    rsyslog 의 규칙 파일은 텍스트 파일이므로 관리가자 vi 로 수정할 수 있다.
    규칙은 로그 메시지 중 어떤 메시지를 선택할 것인지를 정의한 선택자(selecot, 필터라고도 함)와 선택된 메시지를 어떻게 처리할 것인지를 정의한 동작(action)으로 구성되어있다.
    규칙은 한 행에 선택자와 동작으로 작성한다.

---

## 선택자
    rsyslog의 선택자는 기능명(facility)과 우선순위(priority)를 기반으로 함
    ex) 기능명.우선순위

> 기능명

    기능명은 로그메시지를 생성하는 프로그램을 지정한 것이다. 보통은 daemon일거고 로그메시지를 생성하는 프로그램마다 다르게 출력될 것이다. 자세한건 출처를 참고.

> 우선순위

    메시지의 심각도를 나타내는 우선순위를 의미한다.
    심각도는 'emerg'부터 'debug'까지 8단계로 구분한다.
    각 단계를 명확하게 구분하기 어려울 수 있다.

> 선택자 적용

    기능명과 우선순위를 결합하는 방법이다.
    rsyslog 선택자 구성의 예
    > kern.* : 우선순위에 상관없이 커널의 모든 로그 메시지를 선택
    > mail.crit : 메일에서 crit 이상의 우선순위를 가진 모든 로그 메시지를 선택
    > cron.!info.!debug : cron에서 info와 debug를 제외한 모든 로그 메시지를 선택
    > mail.=info : 메일에서 심각도가 info인 경우에만 로그 메시지를 선택

> 동작

    동작은 선택자가 선택한 메시지를 어떻게 처리할 것인지를 정의한 것이다.
    동작은 메시지를 파일로 저장하거나 메일로 전송하기, 화면으로 출력하기 등이 있다.
    rsyslog 동작의 종류
    > *.* @192.168.0.1 : 메시지를 192.168.0.1의 rsyslog 데몬으로 보냄 
    > *.* @abc.com:18 : 메시지를 abc.com의 18번 포트로 TCP를 통해 보냄 
    > *.* 파일명 : 메시지를 지정한 파일에 저장 
    > *.* user1, user2 : 메시지를 user1, user2 사용자의 화면으로 출력 
    > *.* * : 메시지를 현재 로그인한 모든 사용자에게 보냄 
    > cron.* ~ : ~는 cron이 발생시킨 모든 메시지를 무시함
    > kern* ^exe:form : 커널이 발생시킨 메시지를 form이 형식을 조정하여 exe 프로그램에 전달하고 exe 프로그램을 실행함

출처: https://sharkmino.tistory.com/1613