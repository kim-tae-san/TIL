# 데몬셋

데몬셋은 디플로이먼트의 replicas가 노드만큼 정해져 있는 형태라고 할 수 있는데, 노드 하나당 파드 한개만을 생성한다.

> 데몬셋을 언제 사용하는게 좋은가? 

    데몬셋을 사용하는 예로는 Calico 네트워크 플러그인과 kube-proxy를 생성할 때, MetalLB의 스피커에서 사용된다. 이들의 공통점은 노드의 단일 접속 지점으로 노드 외부와 통신하는 것이다. 그렇기 때문에 파드가 1개 이상 필요하지 않는다. 


# 컨피그맵

컨피그맵은 이름 그대로 설정을 목적으로 사용하는 오브젝트이다. MetalLB를 구성할 때 컨피그맵을 사용했다. 인그레스에서는 설정을 위해 오브젝트를 인그레스로 선언했는데, 왜 MetalLB에서는 컨피그맵을 사용한걸까?

명확히 말하기는 어렵지만 인그레스는 오브젝트가 인그레스로 지정돼 있지만, MetalLB는 프로젝트 타입으로 정해진 오브젝트가 없어서 범용 설정으로 사용되는 컨피그맵을 지정했다.


# PV와 PVC

쿠버네티스를 사용하다 보면 파드에서 생성한 내용을 기록하고 보관하거나 모든 파드가 동일한 설정 값을 유지하고 관리하기 위해 공유된 볼륨으로부터 공통된 설정을 가지고 올 수 있도록 설계해야 할 때가 있다.

쿠버네티스는 이런 경우를 위해 다음과 같은 목적으로 다양한 형태의 볼륨을 제공한다.

다양한 쿠버네티스 볼륨 스토리지 중에서 PV와 PVC에 대해 알아보자.

쿠버네티스는 필요할 때 PVC(Persistent Volume Claim)를 요청해 사용한다. PVC를 사용하려면 PV(Persistent Volume)로 볼륨을 선언해야 한다. 간단하게 PV는 볼륨을 사용할 수 있게 준비하는 단계이고, PVC는 준비된 볼륨에서 일정 공간을 할당 받는 것이다. 비유하면 PV는 요리사가 피자를 굽는것이고, PVC는 손님이 원하는 만큼의 피자를 접시에 담아 가져오는것이다. 

관리자와 사용자가 나뉘어 있지 않다면 바로 NFS 볼륨에 마운트 할 수 있다.

# 스테이트풀셋

지금까지는 파드가 replicas에 선언된 만큼 무작위로 생성될 뿐이었다. 그런데 파드가 만들어지는 이름과 순서를 예측해야 할 때가 있다. 주로 레디스, 주키퍼, 카산드라, 몽고DB등의 마스터-슬레이브 구조 시스템에서 필요하다.

이때 스테이트풀셋을 사용한다. 스테이트풀셋은 volumeClaimTemplates 기능을 사용해 PVC를 자동으로 생성할 수 있고, 각 파드가 순서대로 생성되기 때문에 고정된 이름, 볼륨, 설정등을 가질 수 있다. 그래서 StatefulSet이라는 이름을 사용한다.

