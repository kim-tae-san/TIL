# Go Routine

> go routined이란?

    고루틴은 Go 런타임이 관리하는 논리적 쓰레드이다. 함수를 호출할 때 앞에 'go'라는 키워드를 붙여서 호출하면 호출하는 함수와 현재 실행하고 있는 함수의 흐름이 구분되어 별개로 동작한다. 'go' 키워드를 붙여서 호출한 함수는 동시성을 가진다고 할 수 있으며 고루틴끼리의 의존 관계가 없으므로 고루틴 함수의 실행 순서는 프로그램에 영향을 미치지 않는다. 즉 고루틴은 함수의 실행을 동시에 수행하고자 할때 사용한다.

> goroutine을 제어

    흐름이 분리된 고루틴은 sync 패키지를 통해 제어해야 한다. 
    sync 패키지는 mutual exclusion lock과 같은 동기화 기능을 제공한다. 
    
    흔히 사용하는 sync.Once나 sync.WaitGroup의 경우 낮은 수준의 동기화를 수행하는데, 높은 수준의 동기화를 위해서는 이후에 설명할 채널을 사용한다.
    
    WaitGroup을 선언하면 기본 값이 0인 카운터가 생성된다. 이 카운터의 값은 메인 고루틴이 끝나기를 기다리는 고루틴의 개수이다.  WaitGroup의 메서드는 Add, Done, Wait 세가지가 있다.

 
    * func (wg *WaitGroup) Add(delta int)

    Add 함수는 호출될 때마다 카운터에 delta 값을 더한다. delta에는 음수를 포함한 모든 정수가 들어갈 수 있다. 메인 고루틴이 기다려야 하는 고루틴의 수를 증가시킬 때 사용한다. 물론 Add(-x)와 같이 음수를 전달하여 Done 함수의 동작을 수행할 수도 있지만 보통 알아보기 쉽게 나누어 사용한다.

 

    * func (wg *WaitGroup) Done()

    Done 함수는 고루틴의 동작을 완료하여 종료한다는 뜻으로 사용된다. 호출될 때마다 WaitGroup의 카운터를 1만큼 감소시킨다.

 

    * func (wg *WaitGroup) Wait()

    Wait 함수는 WaitGroup의 카운터 값이 0이 될 때까지 기다린다. Add로 기다려야 고루틴의 수만큼 카운터를 증가시키고 고루틴이 종료될 때마다 Done을 호출하여 카운터 값을 감소시킨다. Wait 함수를 통해 모든 고루틴이 종료되어 카운터 값이 0이 될 때까지 기다리므로 실행중인 고루틴이 수행 완료되기 전에 메인 고루틴이 종료되는 것을 방지할 수 있다.

 

    WaitGroup을 활용하기 위해서는 Go에서 제공하는 익명 함수와 함께 defer를 사용해야 한다. 다음으로는 익명함수와 함께 고루틴을 사용하는 방법에 대해서 알아보자.