# í´ë¡œì €(Closure)

    í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì—ì„œì˜ í´ë¡œì €ë€ í¼ìŠ¤íŠ¸í´ë˜ìŠ¤ í•¨ìˆ˜ë¥¼ ì§€ì›í•˜ëŠ” ì–¸ì–´ì˜ ë„¤ì„ ë°”ì¸ë”© ê¸°ìˆ ì´ë‹¤. í´ë¡œì €ëŠ” ì–´ë–¤ í•¨ìˆ˜ë¥¼ í•¨ìˆ˜ ìì‹ ì´ ê°€ì§€ê³  ìˆëŠ” í™˜ê²½ê³¼ í•¨ê»˜ ì €ì¥í•œ ë ˆì½”ë“œì´ë‹¤. ë˜í•œ í•¨ìˆ˜ê°€ ê°€ì§„ í”„ë¦¬ë³€ìˆ˜(free variable)ë¥¼ í´ë¡œì €ê°€ ë§Œë“¤ì–´ì§€ëŠ” ë‹¹ì‹œì˜ ê°’ê³¼ ë ˆí¼ëŸ°ìŠ¤ì— ë§µí•‘í•˜ì—¬ ì£¼ëŠ” ì—­í• ì„ í•œë‹¤. í´ë¡œì €ëŠ” ì¼ë°˜ í•¨ìˆ˜ì™€ëŠ” ë‹¤ë¥´ê²Œ, ìì‹ ì˜ ì˜ì—­ ë°–ì—ì„œ í˜¸ì¶œëœ í•¨ìˆ˜ì˜ ë³€ìˆ˜ê°’ê³¼ ë ˆí¼ëŸ°ìŠ¤ë¥¼ ë³µì‚¬í•˜ê³  ì €ì¥í•œ ë’¤, ì´ ìº¡ì²˜í•œ ê°’ë“¤ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤€ë‹¤.

> í”„ë¦¬ë³€ìˆ˜(free variable)ë€?

    íŒŒì´ì¬ì—ì„œ í”„ë¦¬ë³€ìˆ˜ëŠ” ì½”ë“œë¸”ëŸ­ì•ˆì—ì„œ ì‚¬ìš©ì€ ë˜ì—ˆì§€ë§Œ, ê·¸ ì½”ë“œë¸”ëŸ­ì•ˆì—ì„œ ì •ì˜ë˜ì§€ ì•Šì€ ë³€ìˆ˜ë¥¼ ëœ»í•©ë‹ˆë‹¤.

> í´ë¡œì € ì˜ˆì‹œ

```py
def outer_func(): # 1
    message = 'Hi' # 3

    def inner_func(): # 4
        print message # 6 

    return inner_func() # 5

outer_func() # 2
```

    #1ì—ì„œ ì •ì˜ëœ í•¨ìˆ˜ outer_funcë¥¼ #2ì—ì„œ í˜¸ì¶œì„ í•©ë‹ˆë‹¤. ë¬¼ë¡  outer_funcëŠ” ì–´ë–¤ ì¸ìˆ˜ë„ ë°›ì§€ ì•ŠìŠµë‹ˆë‹¤.

    outer_funcê°€ ì‹¤í–‰ëœ í›„, ê°€ì¥ ë¨¼ì € í•˜ëŠ” ê²ƒì€ messge ë¼ëŠ” ë³€ìˆ˜ì— â€˜Hiâ€™ë¼ëŠ” ë¬¸ìì—´ì„ í• ë‹¹í•©ë‹ˆë‹¤. #3ì…ë‹ˆë‹¤.

    #4ë²ˆì—ì„œ inner_funcë¥¼ ì •ì˜í•˜ê³  #5ë²ˆì—ì„œ inner_funcë¥¼ í˜¸ì¶œí•˜ë©° ë™ì‹œì— ë¦¬í„´í•©ë‹ˆë‹¤.

    #6ì—ì„œ message ë³€ìˆ˜ë¥¼ ì°¸ì¡°í•˜ì—¬ ì¶œë ¥í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ messageëŠ” inner_func ì•ˆì—ì„œ ì •ì˜ë˜ì§€ëŠ” ì•Šì•˜ì§€ë§Œ, inner_func ì•ˆì—ì„œ ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì— í”„ë¦¬ë³€ìˆ˜ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.

â€œHiâ€ê°€ ì¶œë ¥ë˜ê¸°ê¹Œì§€ì˜ ì¼ë ¨ì˜ í”„ë¡œì„¸ìŠ¤ëŠ” ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤. ì—¬ê¸°ê¹Œì§€ëŠ” ì´í•´í•˜ê¸° ì–´ë ¤ìš´ ì ì´ í•˜ë‚˜ë„ ì—†ìŠµë‹ˆë‹¤. ê·¸ëŸ¼ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ ë³´ì£ .

```py
def outer_func(): # 1
    message = 'Hi' # 3

    def inner_func(): # 4
        print(message)  # 6

    return inner_func # 5

my_func = outer_func() # 2

my_func() # 7
my_func() # 8
my_func() # 9
```

    Hi
    Hi
    Hi
my_func()ë¥¼ 3ë²ˆ ì‹¤í–‰í•˜ì—¬ â€œHiâ€ë¥¼ 3ë²ˆ ì¶œë ¥í•˜ì˜€ìŠµë‹ˆë‹¤. ê·¸ëŸ°ë° ë­”ê°€ ì´ìƒí•©ë‹ˆë‹¤. outer_funcëŠ” ë¶„ëª…íˆ #2ì—ì„œ í˜¸ì¶œëœ í›„, ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ°ë° #7, #8, #9ì—ì„œ í˜¸ì¶œëœ my_func(*ì—¬ê¸°ì„œ my_funcëŠ” inner_funcì™€ ê°™ë‹¤ëŠ” ì ì„ ê¸°ì–µí•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.) í•¨ìˆ˜ê°€ outer_func í•¨ìˆ˜ì˜ ë¡œì»¬ë³€ìˆ˜ì¸ messageë¥¼ ì°¸ì¡°í–ˆë‹¤ëŠ” ê²ë‹ˆë‹¤. í â€¦ ì‹ ê¸°í•˜ë„¤ìš”â€¦ ì–´ë–»ê²Œ ê°€ëŠ¥í–ˆì„ê¹Œìš”? ê·¸ í•´ë‹µì€ í´ë¡œì €ì…ë‹ˆë‹¤. í´ë¡œì €ëŠ” í•¨ìˆ˜ì˜ í”„ë¦¬ë³€ìˆ˜ ê°’ì„ ì–´ë”˜ê°€ì— ì €ì¥í•œë‹¤ê³  í–ˆë˜ê²ƒ ê°™ìŠµë‹ˆë‹¤. ë„ëŒ€ì²´ ì–´ë””ì— ì €ì¥ì„ í•˜ëŠ” ê±¸ê¹Œìš”? ê°™ì´ ê·¸ ë¹„ë°€ì„ íŒŒí•´ì³ ë³´ì‹œì£ . ã…‹

ì¼ë‹¨ ì½”ë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•œ í›„, ì‹¤í–‰í•˜ì—¬ ë³´ì£ .

```py
 def outer_func():  # 1
    message = 'Hi'  # 3

    def inner_func():  # 4
        print(message)  # 6

    return inner_func  # 5

my_func = outer_func()  # 2

print(my_func)  # 7
print()
print(dir(my_func))  # 8
print()
print(type(my_func.__closure__))  # 9
print()
print(my_func.__closure__)  # 10
print()
print(my_func.__closure__[0])  # 11
print()
print(dir(my_func.__closure__[0]))  # 12
print()
print(my_func.__closure__[0].cell_contents)  # 13
```

    <function outer_func.<locals>.inner_func at 0x000002913914AA60>

    ['__annotations__', '__call__', '__class__', '__closure__', '__code__', '__defaults__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__get__', '__getattribute__', '__globals__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__kwdefaults__', '__le__', '__lt__', '__module__', '__name__', '__ne__', '__new__', '__qualname__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__']

    <class 'tuple'>

    (<cell at 0x000002913910B730: str object at 0x0000029139147B70>,)

    <cell at 0x000002913910B730: str object at 0x0000029139147B70>

    ['__class__', '__delattr__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__ne__', '__new__', '__reduce__', '__reduce_ex__','__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', 'cell_contents']

    Hi

    ì¶œë ¥ëœ ê²°ê³¼ë¥¼ í•˜ë‚˜ì”© í™•ì¸í•˜ê² ìŠµë‹ˆë‹¤.

    #7 ê²°ê³¼: my_func ë³€ìˆ˜ì— inner_func í•¨ìˆ˜ ì˜¤ë¸Œì íŠ¸ê°€ í• ë‹¹ë˜ì–´ ìˆëŠ” ê²ƒì€ ìœ„ì—ì„œë„ í™•ì¸ì„ í•˜ì˜€ìŠµë‹ˆë‹¤.

    #8 ê²°ê³¼: í´ë¡œì €ê°€ ë„ë°ì²´ ì–´ë””ì— ë°ì´í„°ë¥¼ ìˆ¨ê¸°ëŠ”ì§€ dir() ëª…ë ¹ì–´ë¥¼ ì´ìš©í•´ my_funcì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ í™•ì¸í•´ ë´¤ìŠµë‹ˆë‹¤. ì•„í•˜! __closure__ ë¼ëŠ” ì†ì„±ì´ ìˆ¨ì–´ ìˆëŠ” ê²ƒì„ ì•Œì•˜ìŠµë‹ˆë‹¤.

    #9 ê²°ê³¼: __closure__ëŠ” ë¬´ìŠ¨ íƒ€ì…ì¸ì§€ í™•ì¸í•´ ë´¤ìŠµë‹ˆë‹¤. íƒ€ì…ì€ íŠœí”Œì´ë¼ê³  í•˜ë„¤ìš”.

    #10 ê²°ê³¼: ê·¸ íŠœí”Œì•ˆì— ë­ê°€ ë“¤ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ ë´¤ìŠµë‹ˆë‹¤. ì•„ì´í…œì´ í•˜ë‚˜ ë“¤ì–´ìˆë„¤ìš”.

    #11 ê²°ê³¼: íŠœí”Œì•ˆì— ì²« ë²ˆì§¸ ì•„ì´í…œì…ë‹ˆë‹¤. â€œcellâ€ì´ë¼ëŠ” ë¬¸ìì—´ ì˜¤ë¸Œì íŠ¸ë„¤ìš”.

    #12 ê²°ê³¼: ì´ cell ì˜¤ë¸Œì íŠ¸ëŠ” ì–´ë–¤ ì†ì„±ë“¤ì„ ê°€ì§€ê³  ìˆì„ê¹Œìš”? ì—¬ê¸°ì— ë­”ê°€ ë‹µì´ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. â€œcell_contentsâ€ë¼ëŠ” ì†ì„±ì´ ìˆë„¤ìš”.

    #13 ê²°ê³¼: cell_contentsì—ëŠ” ë­ê°€ ë“¤ì–´ ìˆëŠ”ì§€ í™•ì¸ í•´ ë³´ê² ìŠµë‹ˆë‹¤. â€˜Hiâ€™ê°€ ë“¤ì–´ ìˆë„¤ìš”. ğŸ™‚

    ë“œë””ì–´ í´ë¡œì €ê°€ ì–´ë””ì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ”ì§€ í˜ë“¤ê²Œ ì•Œì•„ëƒˆìŠµë‹ˆë‹¤. ^^;;

    ì—¬ê¸°ì„œ ë¶€í„° í•¨ìˆ˜ì˜ íŒŒë¼ë©”í„°ë¥¼ ì‚¬ìš©í•˜ë©´ ë”ìš± ë” ì¬ë°ŒëŠ” ì½”ë“œë¥¼ ë§Œë“¤ ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒì˜ ì½”ë“œë¥¼ ì €ì¥í•˜ê³  ì‹¤í–‰í•´ ë´…ì‹œë‹¤.

```py
def outer_func(tag):  # 1
    text = 'Some text'  # 5
    tag = tag  #6

    def inner_func():  # 7
        print('<{0}>{1}<{0}>'.format(tag, text))  # 9

    return inner_func  # 8

h1_func = outer_func('h1')  # 2
p_func = outer_func('p')  # 3

h1_func()  # 4
p_func()  # 10
```

    <h1>Some text<h1>
    <p>Some text<p>
outer_func í•¨ìˆ˜ í•˜ë‚˜ë¡œ h1íƒœê·¸ì™€ píƒœê·¸ë¡œ ë¬¸ìì—´ì„ ê°ì‹¸ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ ë´¤ìŠµë‹ˆë‹¤. ì´ë²ˆì—ëŠ” íƒœê·¸ì•ˆì˜ ë¬¸ìì—´ì„ ì»¨íŠ¸ë¡¤í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ ë´…ì‹œë‹¤

```py
def outer_func(tag):  # 1
    tag = tag  # 5

    def inner_func(txt):  # 6
        text = txt  # 8
        print('<{0}>{1}<{0}>'.format(tag, text))  # 9

    return inner_func  # 7

h1_func = outer_func('h1')  # 2
p_func = outer_func('p')  # 3

h1_func('h1 íƒœê·¸ì˜ ì•ˆì…ë‹ˆë‹¤.')  # 4
p_func('p íƒœê·¸ì˜ ì•ˆì…ë‹ˆë‹¤.')  # 10
```

    <h1>h1 íƒœê·¸ì˜ ì•ˆì…ë‹ˆë‹¤.<h1>
    <p>p íƒœê·¸ì˜ ì•ˆì…ë‹ˆë‹¤.<p>

í´ë¡œì €ëŠ” ì´ë ‡ê²Œ í•˜ë‚˜ì˜ í•¨ìˆ˜ë¡œ ì—¬ëŸ¬ê°€ì§€ì˜ í•¨ìˆ˜ë¥¼ ê°„ë‹¨íˆ ë§Œë“¤ì–´ë‚¼ ìˆ˜ ìˆê²Œë„ í•´ì£¼ë©°, ê¸°ì¡´ì— ë§Œë“¤ì–´ì§„ í•¨ìˆ˜ë‚˜ ëª¨ë“ˆë“±ì„ ìˆ˜ì •í•˜ì§€ ì•Šê³ ë„ wrapper í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ê¸°íŠ¹í•œ ë…€ì„ì…ë‹ˆë‹¤.